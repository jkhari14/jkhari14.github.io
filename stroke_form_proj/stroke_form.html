<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Stroke Risk Questionnaire</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../styles.css">
        <link rel="stylesheet" href="stroke_form.css">
        <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    </head>
    
    <body>
                <!--<py-script src="./test.py"></py-script> -->
        <nav class="navbar"> 
            <ul class="navbar-items">
               <div class="nav-button"><li class="navbar-items"><a href="../index.html">Home</a></li></div>
               <div class="nav-button"> <li class="navbar-items"><a href="../jahleel_murray_resume_page.htm">Resume</a></li> </div>
               <div class="nav-button"> <li class="dropdown">
                  <a class="active" class="dropbtn" href="javascript:void(0)">Projects</a>
                  <div class="dropdown-content">
                     <a href="../tic_tac_toe_proj/tic_tac_toe.html">Fic-Fac-Foe</a>
                     <a href="stroke_form_proj/stroke_form.html">Stroke Risk Predictor</a>
                  </div>
               </li></div>
               <div class="nav-button"> <li class="navbar-items"><a href="../aboutme.html">About Me</a></li> </div>
            </ul>
         </nav> 
        <form id="stroke-form-shell" action="stroke_form.html" method="POST" onsubmit="return false">
            <div>
            <div id="stroke-form-div" class="stroke-form">
                <div class="stroke-header">
                    <h2  id="control-2553369">Stroke Risk Questionnaire</h2></div>
                    <img id="stroke-img" src="https://www.brainandlife.org/siteassets/online-exclusives/covid-19/stroke-main.jpg">
                <div class="text-field-user-name">
                    <label for="user-name" class="text-label">Name: </label>
                    <input value="John Doe" type="text" class="stroke-input" name="user-name"  id="user-name" required="required" aria-required="true">
                </div>
                <div class="number-field-age">
                    <label for="age" class="number-label">Age: </label>
                    <input value="50" type="number" class="stroke-input" name="age"  id="age" required="required" aria-required="true">
                </div>
                <div class="select-field-gender">
                    <label for="gender" class="select-label">Biological Sex: </label>
                    <select class="stroke-select-field" name="gender" id="gender">
                        <option value="Male" selected="true" id="gender-0">Male</option>
                        <option value="Female" id="gender-1">Female</option>
                    </select>
                </div>
                <div class="select-field-marriage-status">
                    <label for="marriage-status" class="select-label">Marriage Status: </label>
                    <select class="stroke-select-field" name="marriage-status" id="marriage-status">
                        <option value="No" id="marriage-status-0">Single</option>
                        <option value="Yes" id="marriage-status-1">Married</option>
                    </select>
                </div>
                <div class="select-field-work-type">
                    <label for="work-type" class="select-label">Work Type: </label>
                    <select class="stroke-select-field" name="work-type" id="work-type">
                        <option value="Private" id="work-type-0">Private Company</option>
                        <option value="Govt_job" id="work-type-1">Federal Company</option>
                        <option value="children" id="work-type-2">Stay At Home</option>
                        <option value="Self-employed" id="work-type-3">Self Employed</option>
                    </select>
                </div>
                <div class="select-field-residence-type">
                    <label for="residence-type" class="select-label">Residence Type: </label>
                    <select class="stroke-select-field" name="residence-type" id="residence-type">
                        <option value="Urban" id="residence-type-0">Urban</option>
                        <option value="Rural" id="residence-type-1">Rural</option>
                    </select>
                </div>
                <div class="select-field-hypertension">
                    <label for="hypertension" class="select-label">Have you ever had hypertension?  </label>
                    <select class="stroke-select-field" name="hypertension" id="hypertension">
                        <option value=0 id="hypertension-0">No</option>
                        <option value=1 id="hypertension-1">Yes</option>
                    </select>
                </div>
                <div class="select-field-hypertension">
                    <label for="heart-disease" class="select-label"> Have you ever had a heart disease/condition? </label>
                    <select class="stroke-select-field" name="heart-disease" id="heart-disease">
                        <option value=0 id="heart-disease-0">No</option>
                        <option value=1 id="heart-disease-1">Yes</option>
                    </select>
                </div>
                <div class="select-field-smoke">
                    <label for="smoke" class="select-label"> Have you ever smoked? If so, how often did/do you smoke? </label>
                    <select class="stroke-select-field" name="smoke" id="smoke">
                        <option value="smokes" id="smoke-0">Smokes</option>
                        <option value="never smoked" id="smoke-1">Never Smoked</option>
                        <option value="formerly smoked" id="smoke-2">Formerly Smoked</option>
                        <!-- <option value="unknown-smoke" id="smoke-3">Can't Say</option> -->
                    </select> 
                </div>
                <div class="number-field-average-glucose-level">
                    <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4322747/"> 
                        <label title="Click here to See How to measure Glucose Level" for="average-glucose-level" class="number-label">Average Glucose Level: </label>
                    </a>
                    <input value="100" type="number" class="stroke-input" name="average-glucose-level"  id="average-glucose-level" required="required" aria-required="true">
                </div>
                <div class="number-field-bmi">
                    <a href="https://tinyurl.com/ydzmjad8"> 
                        <label title="Click here to See How to measure Body Mass Index" for="bmi" class="number-label">Body Mass Index: </label>
                    </a>
                    <input value="30" type="number" class="stroke-input" name="bmi"  id="bmi" required="required" aria-required="true">
                </div>
                <div class="stroke-form-buttons">
                    <button type="button" class="submit-button" name="submit-button" id="submit-button">Get Results</button>
                    <button type="button" onClick="window.location.reload(true)" class="reset-button" name="reset-button" id="reset-button">Reset Form</button>
                </div>

                <label id="acl" for="answersContainer">Stroke Risk: </label>   
                <div id="answersContainer" class="answersContainer">
                    <p>A Stroke is a very serious condition. When a blood vessel that supplies the brain with oxygen and nutrients becomes blocked  by a clot or breaks, a stroke ensues. A portion of the brain dies when it is deprived of the blood (and oxygen) it needs.  However,&#160;stroke prevention is possible in 80% of cases.</p>
                </div>
                <div id="output_div" style="margin-top: 10px;margin-bottom: 10px;"></div>
            </div>
            </div>
        </form>
        <py-env>
            - numpy  
            - pandas
            - joblib
            - BeautifulSoup4
            - pyodide.http
            - scikit-learn
        </py-env> 
        <py-script>
        from js import document, console
        from pyodide.ffi import create_proxy
        import pandas as pd;
        import numpy as np;
        import joblib
        from sklearn import preprocessing 
        label_encoder = preprocessing.LabelEncoder
        import os
        
        def runPython(self):
            element_vals = [] 
            element_ids = ["user-name", "gender", "age", "hypertension", "heart-disease", "marriage-status", "work-type", "residence-type", "average-glucose-level", "bmi", "smoke"]
            for i in range(len(element_ids)):
                input_obj = document.getElementById(element_ids[i])
                if input_obj.value == '' or input_obj.value == None:
                    console.log('Please fill out all the Forms to get your results.')
                    return
                element_vals.append(input_obj.value)
            user_name = element_vals[0]        
            df_d = {}
            for i in range(1, len(element_vals)):
                df_d[element_ids[i]] = [element_vals[i]]
            df_clean = pd.DataFrame(data=df_d)
            df_clean['gender'] = label_encoder().fit_transform(df_clean['gender'])
            df_clean['gender'].unique()
            df_clean['marriage-status'] = label_encoder().fit_transform(df_clean['marriage-status'])
            df_clean['marriage-status'].unique()
            df_clean_ohe = pd.get_dummies(data=df_clean, columns=['work-type', 'residence-type', 'smoke'])
            X = df_clean_ohe.values
            verdict = []
            for i in range(40):
                # Load the model from the file
                stroke_pickle = joblib.load(f'stroke_model_pickles/stroke_model{i}.pkl')
                # Use the loaded model to make predictions
                verdict.append(stroke_pickle.predict(X))
            if np.mean(verdict) > 0.667:
                answer = f"Hi {user_name}, According to our Machine Learning model you appear to be at Substantial Risk for having a stroke, over 6% of those with similar criteria to yours have suffered from one according to our database."
            else:
                answer = f"Hi {user_name}, According to our Machine Learning model you appear to not be at Risk for having a stroke with chances as low as 0.46% of getting one."
            document.getElementById("output_div").innerText = answer
        
        function_proxy = create_proxy(runPython)
        
        document.getElementById("submit-button").addEventListener("click", function_proxy)
        </py-script>
       <!-- <script src="stroke_form.js"></script> --> 
    </body>
</html>